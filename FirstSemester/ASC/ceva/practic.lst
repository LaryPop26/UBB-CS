     1                                  bits 32
     2                                  
     3                                  global start        
     4                                  
     5                                  extern exit, fopen, fclose, printf, fwrite, fseek
     6                                  import exit msvcrt.dll
     7                                  import fopen msvcrt.dll
     8                                  import fclose msvcrt.dll
     9                                  import printf msvcrt.dll
    10                                  import fseek msvcrt.dll
    11                                  import fwrite msvcrt.dll
    12                                  
    13                                  segment data use32 class=data
    14 00000000 6669736965722E7478-         nume_fisier db "fisier.txt", 0    ; Numele fișierului care va fi creat sau deschis
    14 00000009 7400               
    15 0000000B 722B00                      mod_acces db "r+", 0              ; Modul de acces pentru fopen (read and write)
    16 0000000E FFFFFFFF                    descriptor_f dd -1                ; Descriptorul fișierului
    17                                      len equ 100                        ; Lungimea buffer-ului textului
    18 00000012 00<rept>                    text times 100 db 0               ; Buffer pentru text
    19 00000076 44657363726970746F-         afisare_format db "Descriptorul este %x", 0  ; Format pentru afișarea descriptorului în hexazecimal
    19 0000007F 72756C206573746520-
    19 00000088 257800             
    20 0000008B 256400                      format db "%d", 0                 ; Format pentru afișarea în decimal
    21                                  
    22                                  segment code use32 class=code
    23                                  start:
    24                                      ; fopen(nume, mod_acces)
    25 00000000 68[0B000000]                push dword mod_acces
    26 00000005 68[00000000]                push dword nume_fisier
    27 0000000A FF15[00000000]              call [fopen]
    28 00000010 83C408                      add esp, 4 * 2
    29                                  
    30 00000013 A3[0E000000]                mov [descriptor_f], eax          ; Salvare descriptor fișier
    31                                  
    32 00000018 83F800                      cmp eax, 0                         ; Verificare dacă fopen a avut succes
    33 0000001B 7470                        je final                          ; Dacă nu, iesire din program
    34                                  
    35                                      ; Printeaza descriptorul in baza 16
    36 0000001D FF35[0E000000]              push dword [descriptor_f]
    37 00000023 68[76000000]                push afisare_format
    38 00000028 FF15[00000000]              call [printf]
    39 0000002E 83C408                      add esp, 8
    40                                  
    41                                      ; Pozitionare la inceputul fisierului
    42 00000031 FF35[0E000000]              push dword [descriptor_f]         ; Descriptor fisier
    43 00000037 6A00                        push dword 0                      ; Offset
    44 00000039 6A00                        push dword 0                      ; Origin (SEEK_SET - de la inceput)
    45 0000003B FF15[00000000]              call [fseek]
    46 00000041 83C40C                      add esp, 12
    47                                  
    48                                      ; Scrie cifrele impare din descriptor in fisier
    49 00000044 A1[0E000000]                mov eax, [descriptor_f]
    50 00000049 BB0A000000                  mov ebx, 10
    51 0000004E B900000000                  mov ecx, 0
    52                                  
    53                                  write_digits:
    54 00000053 BA00000000                  mov edx, 0
    55 00000058 F7F3                        div ebx
    56 0000005A F7C201000000                test edx, 1
    57 00000060 7417                        jz not_odd
    58                                  
    59 00000062 80C230                      add dl, '0'
    60                                      ; fwrite(&dl, 1, 1, file)
    61 00000065 6A01                        push dword 1
    62 00000067 6A01                        push dword 1
    63 00000069 52                          push dword edx
    64 0000006A FF35[0E000000]              push dword [descriptor_f]
    65 00000070 FF15[00000000]              call [fwrite]
    66 00000076 83C410                      add esp, 16
    67                                  
    68                                  not_odd:
    69 00000079 83F800                      cmp eax, 0
    70 0000007C 75D5                        jnz write_digits
    71                                  
    72                                      ; fclose(file)
    73 0000007E FF35[0E000000]              push dword [descriptor_f]
    74 00000084 FF15[00000000]              call [fclose]
    75 0000008A 83C404                      add esp, 4
    76                                  
    77                                  final:
    78                                      ; exit(0)
    79 0000008D 6A00                        push dword 0
    80 0000008F FF15[00000000]              call [exit]
